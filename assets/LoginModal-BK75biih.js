import{d as M,J as A,K as J,e as C,y as h,L as Q,o as l,c as m,B as H,O as W,i as k,a as f,n as I,h as w,F as O,z as D,t as S,r as L,q as T,_ as P,P as X,k as Y,v as Z,Q as j,R as ee,f as x,w as V,g as R,S as oe,U as se,V as ne}from"./index-BfTxmqvZ.js";import{P as q}from"./PrimaryBtn-CAI_RELy.js";import{C as ae}from"./CircleBtn-D_ORMc0h.js";const te=["type","placeholder"],re={key:0,class:"input-box__icon-container"},le={key:1,class:"input-box__error-list"},ie={class:"input-box__error"},ue={key:3,class:"input-box__btn-close"},ce=M({__name:"AppInput",props:A({modelValue:{},placeholder:{default:""},appearance:{default:"form"},inputIconName:{},type:{default:"text"},focus:{type:Boolean},errors:{}},{modelValue:{},modelModifiers:{}}),emits:A(["input"],["update:modelValue"]),setup(e,{emit:n}){const o=e,c=n,i=J(e,"modelValue"),p=C(()=>({"input-box--search":o.appearance==="search","input-box--form":o.appearance==="form","input-box--error":o.errors,"input-box--password":o.type==="password"})),g=h(!1),t=C(()=>o.type==="password"&&g.value===!0?"text":o.type);function _(){g.value=!g.value}return(s,u)=>{const a=Q("focus");return l(),m("div",{class:L(["input-box",p.value])},[H(k("input",{class:"input-box__input",type:t.value,placeholder:s.placeholder,onInput:u[0]||(u[0]=d=>c("input")),"onUpdate:modelValue":u[1]||(u[1]=d=>i.value=d)},null,40,te),[[a,s.focus||!1],[W,i.value,void 0,{trim:!0}]]),s.inputIconName?(l(),m("div",re,[f(I,{"icon-name":s.inputIconName},null,8,["icon-name"])])):w("",!0),s.errors&&s.errors.length?(l(),m("ul",le,[(l(!0),m(O,null,D(s.errors,(d,v)=>(l(),m("li",{class:"input-box__error-item",key:v},[k("span",ie,S(d),1)]))),128))])):w("",!0),s.type==="password"?(l(),m("button",{key:2,class:L(["input-box__btn-eye",{"input-box__btn-eye--checked":g.value}]),type:"button",onClick:T(_,["prevent"])},[f(I,{"icon-name":"IconEye"})],2)):w("",!0),s.appearance==="search"?(l(),m("button",ue,[f(I,{"icon-name":"IconClose"})])):w("",!0)],2)}}}),me=P(ce,[["__scopeId","data-v-4f57589c"]]),pe={class:"form__list"},de=M({__name:"AppForm",props:{inputs:{},btnName:{},rules:{},formName:{},showSpinner:{type:Boolean},serverErrors:{}},emits:["submitForm"],setup(e,{emit:n}){const o=e,c=n,i=h({}),p=h({});o.inputs.forEach(s=>{i.value[s.name]=s.value||""});function g(s){var a;const u={};return(a=o.rules)==null||a.forEach(d=>{const v=d.validate(s);if(v){const[y,E]=Object.entries(v)[0];y in u?u[y].push(E):u[y]=[E]}}),u}function t(s){delete p.value[s]}function _(){if((!o.serverErrors||o.serverErrors&&!Object.keys(o.serverErrors).length)&&(p.value=g(i.value)),!Object.keys(p.value).length){const s={formData:i.value,formName:o.formName};c("submitForm",s)}}return X(()=>o.serverErrors,s=>{s&&(p.value=s)}),(s,u)=>(l(),m("form",{class:"form",onSubmit:T(_,["prevent"])},[k("ul",pe,[(l(!0),m(O,null,D(s.inputs,(a,d)=>(l(),m("li",{class:"form__item",key:d},[f(me,{"input-icon-name":a.iconName,placeholder:a.placeholder,type:a.type,focus:a==null?void 0:a.focus,errors:p.value[a.name],onInput:v=>t(a.name),modelValue:i.value[a.name],"onUpdate:modelValue":v=>i.value[a.name]=v},null,8,["input-icon-name","placeholder","type","focus","errors","onInput","modelValue","onUpdate:modelValue"])]))),128))]),f(q,{class:"form__btn-submit",type:"sumbit","bg-color":"light","show-spinner":s.showSpinner,"btn-name":s.btnName},null,8,["show-spinner","btn-name"])],32))}}),B=P(de,[["__scopeId","data-v-844437a1"]]);function fe(e){return typeof e=="object"&&e!==null&&typeof e.email=="string"&&typeof e.password=="string"&&Object.keys(e).length===2}function ve(e){return typeof e=="object"&&e!==null&&typeof e.email=="string"&&typeof e.password=="string"&&typeof e.name=="string"&&typeof e.surname=="string"&&typeof e.confirmPassword=="string"&&Object.keys(e).length===5}function b(e,n){if(e in n)return n[e];throw new TypeError(`Field ${e} not found`)}const ge={required:e=>n=>b(e,n).length?null:{[e]:"This field is required"},minLength:(e,n)=>o=>{const c=b(e,o);return c&&c.length>=n?null:{[e]:`Cannot be shorter than ${n} characters`}},email:e=>n=>{const o=b(e,n);return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)?null:{[e]:"Invalid email"}},sameAs:(e,n)=>o=>{const c=b(e,o),i=b(n,o);return c===i?null:{[e]:"Passwords do not match"}}},he={class:"modal-box__title"},_e={key:0,class:"modal-box__message"},ye=M({__name:"LoginModal",setup(e){const n=Y(),o=Z(),{email:c,minLength:i,required:p,sameAs:g}=ge,t=h("authorization"),_=C(()=>t.value==="authorization"?"Authorization":"Registration"),s=C(()=>t.value==="authorization"?"Registration":"Authorization"),u=h(null),a=h(null),d=[{name:"email",iconName:"IconEmail",placeholder:"E-mail",focus:!0,value:"email@email.com"},{name:"password",iconName:"IconKey",placeholder:"Password",type:"password",value:"111111"}],v=[{name:"email",iconName:"IconEmail",placeholder:"E-mail",focus:!0},{name:"name",iconName:"IconUser",placeholder:"Name"},{name:"surname",iconName:"IconUser",placeholder:"Surname"},{name:"password",iconName:"IconKey",placeholder:"Password",type:"password"},{name:"confirmPassword",iconName:"IconKey",placeholder:"Confirm password",type:"password"}],y=[{validate:c("email")},{validate:p("password")}],E=[{validate:c("email")},{validate:i("name",2)},{validate:i("surname",2)},{validate:i("password",6)},{validate:p("confirmPassword")},{validate:g("confirmPassword","password")}];async function F(){var r;n.toggleModal(!1),(r=n.buttonOpenModal)==null||r.focus(),setTimeout(()=>{var N;return(N=n.buttonOpenModal)==null?void 0:N.focus()})}function U(r){r.key==="Escape"&&F()}function $(){t.value==="authorization"?t.value="registration":(t.value==="registration"||t.value==="success")&&(t.value="authorization")}async function K(r){await o.fetchLogin(r),o.isLogin?n.toggleModal(!1):u.value={email:["Incorrect E-mail or password"],password:["Incorrect E-mail or password"]}}async function G(r){await o.fetchRegistration(r),o.isRegistrationSuccess?t.value="success":a.value={email:["This email address is already registered"]}}function z(r){r.formName==="signIn"&&fe(r.formData)?K(r.formData):r.formName==="signUp"&&ve(r.formData)&&G(r.formData)}return j(()=>{document.addEventListener("keydown",U)}),ee(()=>{document.removeEventListener("keydown",U)}),(r,N)=>(l(),x(ne,{color:"light",onClose:F},{default:V(()=>[f(R(oe),null,{default:V(()=>[k("div",{class:L(["modal-box",{"modal-box--success":!0}])},[f(ae,{class:"modal-box__btn-close",appearance:"modal",onClick:F},{default:V(()=>[f(I,{"icon-name":"IconClose"})]),_:1}),f(I,{class:"modal-box__logo","icon-name":"IconLogo"}),k("h2",he,S(_.value),1),f(se,{name:"flip",mode:"out-in"},{default:V(()=>[t.value==="success"?(l(),m("p",_e," Registration successful! Please use your email to log in. ")):t.value==="authorization"?(l(),x(B,{key:1,class:"modal-box__form","btn-name":"Sign in",inputs:d,rules:y,"server-errors":u.value,"show-spinner":R(o).isLoginLoading,"form-name":"signIn",onSubmitForm:z},null,8,["server-errors","show-spinner"])):t.value==="registration"?(l(),x(B,{key:2,class:"modal-box__form","btn-name":"Sign up",inputs:v,rules:E,"server-errors":a.value,"show-spinner":R(o).isRegistrationLoading,"form-name":"signUp",onSubmitForm:z},null,8,["server-errors","show-spinner"])):w("",!0)]),_:1}),t.value==="success"?(l(),x(q,{key:0,"btn-name":s.value,"bg-color":"light",onClick:$},null,8,["btn-name"])):(l(),m("button",{key:1,class:"modal-box__text-btn",onClick:$},S(s.value),1))])]),_:1})]),_:1}))}}),ke=P(ye,[["__scopeId","data-v-02e96962"]]);export{ke as default};
